# 엔티티

도메인 주도 개발에서의 엔티티는 도메인 모델을 구현한 도메인 객체를 의미한다. (값 객체도 도메인 객체이다.)

## 엔티티의 성질

엔티티는 속성이 아닌 `동일성`으로 식별되는 객체이다. 

사람의 속성에는 나이, 머리색, 피부색, 핸드폰 번호 등이 있는데 이러한 속성이 변한다고 사람이 변하진 않는다. 반대로 속성이 모두 같은면 완전히 같은 것으로 취급하는데
이 것을 `값 객체`라고 부른다.

- 엔티티의 성질
  - 가변이다.
  - 속성이 같아도 구분할 수 있다.
  - 동일성을 통해 구별된다.

### 가변이다

엔티티는 가변성을 갖는다. 즉, 속성이 변할 수 있다. 

단, 모든 속성을 가변으로 만들 필요는 없다. 필요한 속성들만 가변으로 만들 수 있다.

### 속성이 같아도 구분할 수 있다

엔티티는 속성이 아닌 `식별자(identity)`로 구분한다. 식별자로는 보통 `id`값을 사용한다. JPA 의 경우 id 값은 DB 의 인조키이며 시퀀스 값이다.

### 동일성

동일성을 판단하는 수단으로 `식별자(identity)`가 사용된다. 따라서 equals and hashcode 를 구현할때 id 필드에 대한 비교를 해주면 된다. 
그리고 식별자는 가변으로 할 필요는 없다.

## 안전망 역할을 하는 유효성 검증

모델을 나타낸 객체의 값이 도메인 규칙에 부합하는지 검사해야한다. 예를들어 핸드폰의 자릿수가 엉망이라던지 등 잘못된 인자 값을 받으면 예외를 발생시켜 프로그램을 종료해야 한다.

하지만, 예외가 발생하는 것을 전제로 해서는 안되고, 유효성 검사를 사전에 마쳐야 한다. 핸드폰 번호에 문제가 있으면 클라이언트에서 먼저 검증을 하여 '유효하지 않은 값이 많다'라는 의도를
명확하게 드러낼 수 있다.

## 엔티티 판단 기준 - 생애주기와 연속성

생애주기와 연속성을 갖는지의 여부에 따라서 값 객체로 만들 것인지, 엔티티로 만들 것인지 정해진다.

생애주기를 갖는 객체는 태어나서 죽을 때까지 변화를 겪을 수 있다.

## 값 객체도 되고 엔티티도 될 수 있는 모델

대체로 사물은 한 가지 면만 갖지 않는다. 완전히 같은 개념이라도 시스템에 따라서 값 객체로 만들거나 엔티티로 만들어야 할 수도 있다.

타이어를 예로 들면, 자동차 입장에서는 타이어는 값 객체가 적합하다. 하지만 타이어 공장 입장에서는 타이어는 엔티티가 적합하다.

__즉, 같은 대상이라도 어떤 환경에 있냐에 따라 모델링 방법이 달라진다.__

## 도메인 객체를 정의할 때의 장점

엔티티와 값 객체는 서로 성질은 달라도 도메인 모델을 나타내는 도메인 객체이다.

- 도메인 객체를 정의할 때의 장점
  - 자기 서술적인 코드가 된다.
  - 도메인에 변경사항이 있을 시 코드에 반영하기 쉽다.

이 장점은 최초 개발 시점보다는 개발 완료 후 유지보수 시점에 빛을 발한다.

### 자기 서술적인 코드가 된다.

개발자는 프로젝트 중간에 참여할 수도 있고, 하다가 나갈 수도 있다. 사전 지식이 없는 상태에서 소프트웨어의 요구사항을 파악하기 위해서는 자기 서술적인 코드로 작성해야 한다.

예를 들어, 주소(Address) 값 객체에서는 서울시만 받고, 우편번호는 6자리여야 한다는 검증 조건(실패시 예외 발생)을 값 객체에 넣음으로써 의도를 더 명확하게 전달 할 수있다.

### 도메인에 일어난 변경을 코드에 반영하기 쉽다.

예를 들어 우편번호가 8자리로 바뀌었다는 방침이 내려와서 규칙에 변화가 생겼을 때, 도메인 모델의 규칙이 정의된 부분만 찾아서 수정하면 된다.

도메인 객체에 이와 관련된 행동이나 규칙을 코드로 작성해 두면 도메인 모델로 전달된 도메인의 변화를 쉽게 객체까지 전달할 수 있다.

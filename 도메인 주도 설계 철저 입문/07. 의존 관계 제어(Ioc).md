# 소프트웨어의 유연성을 위한 의존 관계 제어

이번 장에서 설명하는 의존 관계 제어는 도메인 로직을 기술적 요소에서 분리해 소프트웨어를 유연하게 만드는 방법이다.

## 의존이란 ?

의존은 어떤 객체가 다른 객체를 참조하면서 발생한다.

- A 가 B 에 의존

```java
public class A {
  private B b;
}
```

`a ---> b`

의존은 의존하는 객체에서 대상이 되는 객체 쪽으로 향하는 화살표를 통해 나타낸다.

의존은 `인터페이스와 구현체`사이에서도 존재한다. Ex. interface 와 impl (속이빈 화살표 = 일반화 관계)

### 추상 타입에 대한 의존(의존 관계 역전 원칙, Inversion Of Control)

```java
@RequiredArgsConstructor
@Service
public class UserService {
  
  // 구현체에 의존 -> 특정 퍼시스턴시 기술에 의존(특정 DB 벤더에 의존)
  // private final UserRepositoryImpl userRepository;

  // IOC -> 추상 타입에 대한 의존 -> 어떤 구현체가 와도 상관 없음
  // private final UserRepository userRepository;
}
```

## 의존 관계 역전 원칙(DIP, Dependency Inversion Principle)

- DIP(Dependency Inversion Principle)
  - 추상화 수준이 높은 모듈이 낮은 모듈에 의존해서는 안 되며 두 모듈 모두 추상 타입에 의존해야 한다.
  - 추상 타입이 구현의 세부 사항에 의존해서는 안 된다. 구현의 세부 사항이 추상 타입에 의존해야 한다.

__DIP 는 소프트웨어를 유연하게 하며, 기술적 요소가 비지니스 로직을 침범하는 일을 막기 위해서는 필수적이다.__

### 추상 타입에 의존하라

추상화 수준은 입출력으로부터의 거리를 뜻한다. 추상화 수준이 낮다는 것은 기계와 가까운 구체적인 거리를 의미하고, 추상화 수준이 높다는 것은 사람과 가까운 추상적인 처리를 말한다.

Repository 가 Service 보다 추상화 수준이 낮다.(데이터스토어를 다루기 때문)

객체지향 원칙 중에 __구현에 의존하지말고 역할에 의존하라__ 즉, DIP 원칙(프로그래머는 추상화에 의존해야지 구체화에 의존하면 안된다.)을 의미한다. 

### 주도권을 추상 타입에 둬라

추상화 수준이 높은 쪽이 주체가 되어야 한다. 낮은 쪽이 주체가 되면, 낮은 곳에서 변경이 일어나면 높은 곳 까지 변경이 일어나기 때문이다.

## 의존 관계 제어하기

상황에 따라 서비스에서 InMemoryRepository 나 개발 중이나 운영 중이라면 데이터베이스와 통신하는 Repository 를 사용할 것이다.

- 생성자에서 의존성을 주입하지만, 구체 클래스에 의존하는 경우

```java
public class Service {
  
  private final Repository repository;
  
  public Service(InMemoryRepository repository) {
    this.repository = repository;
  }

}
```

이렇게 될 경우 나중에 Repository 를 교체해야할 때 비용이 발생한다. 

이러한 문제는 `Service Locator 패턴과 IoC Container 패턴`으로 문제를 해결할 수 있다.

## Service Locator 패턴

## Ioc Container 


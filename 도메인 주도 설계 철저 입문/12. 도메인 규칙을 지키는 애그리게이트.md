# 도메인 규칙을 지키는 애그리게이트

애그리게이트(aggregate)는 `변경의 단위`이다. 데이터를 변경하는 단위로 다뤄지는 객체의 모임을 애그리게이트라고 한다.

애그리게이트에는 루트 객체가 있고, __모든 조작은 이 루트 객체를 통해 이루어진다.__ 그러므로 애그리게이트 내부의 객체에 대한 조작에는 제약이 따르며,
이로 인해 애그리게이트 내부의 불변 조건이 유지된다.

애그리게이트는 데이터 변경의 단위가 되므로 트랜잭션이나 락과도 밀접한 관계를 맺는다.

애그리게이트는 불변 조건을 유지하는 단위로 꾸려지며 객체 조작의 질서를 유지한다.

애그리게이트는 `경계`와 `루트`를 갖는다.

- 경계 : 애그리게이트에 포함되는 대상을 결정하는 경계
- 루트 : 애그리게이트에 포함되는 특정한 객체

## 애그리게이트의 기본 구조

- 루트(root) : User 엔티티 
  - UserId : 값 객체
  - UserName : 값 객체

위 와 같은 묶음을 애그리게이트라고 한다.

외부에서는 애그리게이트 내부에 있는 객체를 조작할 수 없다. 애그리게이트를 조작하는 직접적인 인터페이스가 되는 객체가 `애그리게이트 루트(aggregate root)` 뿐이다.

## 데메테르 법칙 : 객체를 다루는 조작의 기본 원칙

객체 간의 어떤 질서 없이 메서드를 호출하면 불변 조건을 유지하기 어렵다. `데메테르의 법칙`은 객체 간의 메서드 호출에 질서를 부여하기 위한 가이드라인이다.

데메테르 법칙은 어떤 컨텍스트에서 다음 객체의 메서드만을 호출할 수 있게 제한한다.

- 객체 자신
- 인자로 전달받은 객체
- 인스턴스 변수
- 해당 컨텍스트에서 직접 생성한 객체

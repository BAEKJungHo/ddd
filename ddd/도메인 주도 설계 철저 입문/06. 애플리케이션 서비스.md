# 유스케이스를 구현하기 위한 애플리케이션 서비스

애플리케이션 서비스란 유스케이스를 구현하는 객체라고 할 수 있다.

> 애플리케이션이란 일반적으로 이용자의 목적에 부응하는 프로그램을 의미한다. 애플리케이션의 목표는 이용자의 필요를 만족시키고 목적을 달성하게 하는 것이다.

## 유스케이스 수립하기

- 이용자
  - 회원 가입
  - 내 정보
  - 정보 수정
  - 회원 탈퇴

위에 나열된 유스케이스는 CRUD 에 해당한다. 이러한 유스케이스에 해당하는 기능들을 `도메인명+Application+Service` 에 모아두는 것이다.

```java
public class UserApplicationService {
  
  // 회원가입 메서드
  
  // 내 정보 조회 메서드
  
  // 정보 수정 메서드
  
  // 회원 탈퇴 메서드

}
```

### ORM 프레임워크를 사용하지 않는 회사 업무 특징

DDD 관점으로 봤을때 Mybatis 를 사용하여 개발하는 곳은, 보통 repository 1개, 서비스 1개, 서비스 impl 1개 이런식으로 개발하는데,
서비스가 `도메인 서비스 + 애플리케이션 서비스` 역할을 담당하고있다. 그리고 entity 라는 개념을 도입하지 않고 보통, vo 많아야 dto 까지만 사용하며
화면단에 보내야할 속성들까지도 같이 vo 안에 선언해서 거의 god class 처럼 사용한다. 단점은, 이러한 방식의 개발은 객체지향적인개발이 아니고 데이터 중심의 개발이다.
그럼에도 vo 에 모든 속성을 때려 넣어서 개발하는 이유는 `생산성` 때문이다.

## DTO 로 처리하기

도메인 객체를 외부에 공개하기로 했다면 애플리케이션 서비스의 코드가 비교적 간단해지지만, 애플리케이션 서비스를 이용하는 클라이언트 입장에서 의도하지 않게 도메인 객체의 메서드를 호출할 수도 있다.
따라서, 도메인 객체를 외부에 공개한다는 것은 코드를 비교적 단순하게 만들 수는 있지만, 많은 위험성이 따른다. 특히 API 에서는 더욱 위험하다.

이를 방지하기 위한 수단으로 접근제어 수정자(access modifier)를 이용해 메서드 호출을 제한할 수도 있지만, DTO(Data Transfer Object) 를 만들어 처리하는 것이 좋다.

DTO 를 적용하면 DTO 를 정의하는 데 필요한 수고와 데이터를 옮겨 담는 데서 오는 약간의 성능 저하가 따르지만, 엄청난 양의 데이터를 옮겨 담는 것이 아니면 성능저하는 미비한 수준이며, 오히려
불필요한 의존을 줄이고 도메인 객체의 변경을 방해받지 않는 편익이 더 크다.

## 도메인 규칙의 유출

애플리케이션 서비스에는 도메인 규칙이 나타나서는 안 된다.

## 애플리케이션 서비스와 프로그램의 응집도

UserService(도메인 서비스)는 현재 중복 처리와 관련된 역할만 담당하고 있다. UserApplicationService 는 등록 삭제 수정 등의 기능을 수행하며, 등록 시에만 중복 확인을 한다. 즉, 삭제할 때는 중복 확인이 필요 없기 때문에, 현재와 같은 구조는 응집도가 낮은 상태이다.

응집도를 높이기 위해 UserApplicationService 를 다음과 같이 분리할 수 있다.

- UserApplicationService 
  - UserRegisterService
  - UserUpdateService
  - UserDeleteService

응집도가 절대적인 지표사항은 아니지만 위와 같은 방법도 있다.

## 애플리케이션 서비스의 인터페이스

더 유연한 코드를 만들기 위해 애플리케이션 서비스의 인터페이스를 만드는 경우가 있다.

클라이언트 쪽에서는 애플리케이션 서비스의 인터페이스만 호출하기 때문에 편의성이 높아진다.

## 서비스란 무엇인가 ?

서비스는 클라이언트를 위해 무언가를 해주는 존재다.

값 객체와 엔티티는 자신을 위한 행동을 갖고 있지만, 서비스의 행동은 자신을 위한 것이 아니다. 서비스는 어떤 영역에도 존재할 수 있다. (Ex. 도메인 서비스, 애플리케이션 서비스)

### 서비스는 무 상태다

서비스는 자신의 행동을 변화시키는 것을 목적으로 하는 상태를 갖지 않는다.

따라서 전역변수를 선언해서 자신의 행동을 변화시키는 상태값을 가지고 있다면, 큰 문제가 발생할 수 있다. 하지만 이를 서비스가 전형 상태를 갖지 않는다고하면 잘 못 이해한 것이다.

- 상태를 갖는 서비스의 예

```java
public class UserService {
  private final UserRepository userRepository;
}
```

userRepository 는 서비스의 행동을 변화시키지 않는다. 즉, 자신의 행동을 변화시키기 위한 목적의 상태라고 할 수 없다.
